name: Lint YAML and Ansible

on:
  push:
    branches:
      - main
      - "releases/*"
  pull_request:
    branches:
      - "*"

jobs:
  lint:
    name: yamllint and ansible-lint
    runs-on: ubuntu-latest
    steps:
      - name: Check out repository
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"
          cache: "pip"
          cache-dependency-path: requirements/ci-lint.txt

      - name: Install lint dependencies
        run: |
          python -m pip install --upgrade pip
          pip install --requirement requirements/ci-lint.txt

      - name: Run yamllint
        run: yamllint ansible baremetal

      - name: Run ansible-lint
        run: >-
          ansible-lint
          ansible/playbooks/common/generate_autoinstall.yml
          baremetal/ansible/playbooks/generate_autoinstall.yml
          baremetal/ansible/playbooks/discover_hardware.yml
